<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gojo Ultimate Platformer</title>
  <style>
    body { background: #222; margin: 0; overflow: hidden; }
    #gameCanvas {
      background: linear-gradient(to top, #05182d 80%, #b1eaff 100%);
      display: block;
      margin: 0 auto;
      border: 3px solid #111;
      box-shadow: 0 0 30px #000b;
    }
    #hud {
      position: absolute; top: 14px; left: 50%; transform: translateX(-50%);
      color: #fff; background: #191c; padding: 8px 22px; border-radius: 8px;
      font-size: 18px; font-family: sans-serif; letter-spacing: 1px;
      user-select: none; pointer-events: none; z-index:2;
      min-width: 320px;
    }
    #controls {
      position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
      z-index:3;
      display: flex;
      justify-content: center;
      gap: 24px;
      width: 100vw;
      pointer-events: none;
    }
    #spawnBtn {
      pointer-events: auto;
      background: #ffe066;
      color: #222;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      padding: 10px 22px;
      cursor: pointer;
      margin-right:18px;
      box-shadow: 0 0 10px #0005;
      transition: background .18s;
    }
    #spawnBtn:hover {
      background: #ffd60a;
    }
    #ultBarWrap {
      pointer-events: none;
      width: 200px;
      height: 20px;
      background: #333b;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #444a;
      display: flex;
      align-items: center;
      position: relative;
    }
    #ultBar {
      height: 100%;
      background: linear-gradient(90deg,#e3f2fd 0%,#9575cd 100%);
      border-radius: 8px 0 0 8px;
      transition: width .2s;
    }
    #ultText {
      position: absolute; left:0; width: 100%; text-align: center; font-size: 13px;
      color: #fff; text-shadow: 0 0 4px #111c;
      pointer-events:none;
    }
    #ultReadyMsg {
      position: absolute; top: 43px; left: 50%;
      transform: translateX(-50%);
      color: #ffe066;
      font-weight: bold;
      font-size: 20px;
      text-shadow: 0 0 8px #000, 0 0 8px #ffe066;
      z-index: 5;
      display: none;
      pointer-events: none;
    }
    @media (max-width: 700px){
      #gameCanvas { width: 98vw; height: 58vw; }
      #hud, #controls { min-width: 0; }
    }
  </style>
</head>
<body>
  <div id="hud">
    ← → para andar, espaço para pular, <b>J/K/L</b> para ataques, <b>G</b> para Ultimate
  </div>
  <div id="controls">
    <button id="spawnBtn">Spawn Inimigo</button>
    <div id="ultBarWrap">
      <div id="ultBar" style="width:0%"></div>
      <div id="ultText"></div>
    </div>
  </div>
  <div id="ultReadyMsg">Pressione <b>G</b> para acordar!</div>
  <canvas id="gameCanvas" width="600" height="320"></canvas>
  <script>
    // Sprites (sugestão: troque por PNGs reais)
    const gojoSprites = {
      idle: [
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_idle1.png",
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_idle2.png"
      ],
      walkRight: [
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_walk1.png",
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_walk2.png"
      ],
      walkLeft: [
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_walk1_left.png",
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_walk2_left.png"
      ],
      jump: [
        "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/gojo_jump.png"
      ],
    };
    const enemySpriteUrl = "https://raw.githubusercontent.com/mkilll/Jogo-do-abate/main/sprites/enemy1.png";

    // Carregamento dos sprites
    let loadedSprites = {};
    let loadedEnemySprite = null;
    let spritesToLoad = 0, spritesLoaded = 0;
    function preloadSprites(callback) {
      const keys = Object.keys(gojoSprites);
      spritesToLoad = keys.reduce((sum, k) => sum + gojoSprites[k].length, 0) + 1;
      spritesLoaded = 0;
      keys.forEach(key => {
        loadedSprites[key] = [];
        gojoSprites[key].forEach((url, idx) => {
          const img = new Image();
          img.onload = () => {
            loadedSprites[key][idx] = img;
            spritesLoaded++;
            if (spritesLoaded === spritesToLoad) callback();
          };
          img.onerror = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 48;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = "#fff"; ctx.fillRect(0,0,32,48);
            ctx.fillStyle = "#1e6fff"; ctx.fillRect(4,16,24,28);
            ctx.fillStyle = "#111"; ctx.fillRect(8,22,16,10);
            loadedSprites[key][idx] = canvas;
            spritesLoaded++;
            if (spritesLoaded === spritesToLoad) callback();
          };
          img.src = url;
        });
      });
      // Enemy
      const eimg = new Image();
      eimg.onload = () => {
        loadedEnemySprite = eimg;
        spritesLoaded++;
        if (spritesLoaded === spritesToLoad) callback();
      };
      eimg.onerror = () => {
        const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 48;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = "#ff3636"; ctx.fillRect(0,0,32,48);
        ctx.fillStyle = "#000"; ctx.fillRect(8,30,16,8);
        loadedEnemySprite = canvas;
        spritesLoaded++;
        if (spritesLoaded === spritesToLoad) callback();
      };
      eimg.src = enemySpriteUrl;
    }

    // Variáveis do jogo
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const GRAVITY = 0.7;
    const GROUND_Y = 256;
    const PLAYER = {
      x: 100, y: GROUND_Y, vx: 0, vy: 0,
      w: 32, h: 48,
      speed: 2.2, jumpPower: 11,
      dir: 1,
      grounded: true,
      animTimer: 0,
      animFrame: 0,
      state: "idle",
      baseMoveset: true,
      ultActive: false,
      ultTime: 0
    };
    let enemies = [];
    let balloons = []; // fala

    // Barra de ultimate
    let ultValue = 0, ULT_MAX = 100;
    let ultReady = false, ultMode = false, ultTimer = 0;
    let ultSkillState = null;
    let ultSkillTimer = 0;
    let ultSkillData = {};

    // Ataques base
    // J: Azul (dispara bola azul pequena que dá dano)
    // K: Vermelho (dispara feixe vermelho curto que dá dano)
    // L: Vazio (dispara bola roxa pequena, dano em área)
    // (adicionando mais 3 ataques como pedido)
    // U: "Arremesso" (Gojo arremessa um inimigo para cima se próximo)
    // I: "Empurrão" (Gojo empurra inimigos próximos para longe)
    // O: "Campo de energia" (Gojo cria uma barreira que bloqueia projéteis e empurra inimigos)

    let projectiles = [];

    // Ataques Ultimate
    // G: ativa modo ultimate (moveset muda)
    // 1: Azul Máximo (Q) -> bola azul gigante gira e vai ao céu, puxa inimigos
    // 2: Vermelho Máximo (W) -> feixe vermelho; se Azul Máximo está no céu, vira esfera e se funde, criando Bola Roxa Gigante
    // 3: Vazio Roxo (E) -> bola roxa gigante na direção do personagem
    // 4: Expansão de Domínio (R) -> campo, paralisa inimigos por 5s

    // Estado dos moves
    let ultMoves = { azul: false, vermelho: false, vazio: false, dominio: false };
    let azulNoCeu = false, azulObj = null, vermelhoObj = null, roxaoObj = null, dominioObj = null;

    // Input
    let keys = {};
    document.addEventListener('keydown', e => {
      const k = e.key.toLowerCase();
      if (["arrowleft","arrowright"," ","j","k","l","u","i","o","g","q","w","e","r"].includes(k)) e.preventDefault();
      keys[k] = true;
    });
    document.addEventListener('keyup', e => {
      keys[e.key.toLowerCase()] = false;
    });

    // Spawn inimigo botão
    document.getElementById('spawnBtn').onclick = function() {
      spawnEnemy();
    };

    function spawnEnemy() {
      let px = Math.random() > 0.5 ? canvas.width-60 : 60;
      let side = px > canvas.width/2 ? -1 : 1;
      enemies.push({
        x: px, y: GROUND_Y, vx: 1.1 * side, vy: 0,
        w: 32, h: 48, alive:true, anim: 0, paralisado: false, paralyzeTimer: 0
      });
    }

    // Fala
    function balloon(text, px, py, color="#fff", time=70) {
      balloons.push({text, x:px, y:py, color, t:time, max:time});
    }

    function updateBalloons() {
      for (let b of balloons) b.t--;
      balloons = balloons.filter(b=>b.t>0);
    }

    // Lógica principal
    let lastTime = 0;
    function gameLoop(ts) {
      let dt = (ts - lastTime) / 1000; if (!dt||dt>0.2) dt=0.016; lastTime=ts;

      // Ultimate: G para ativar
      if (!ultMode && ultReady && keys["g"]) {
        ultMode = true;
        ultTimer = 0;
        PLAYER.ultActive = true;
        balloon("Modo Ilimitado!", PLAYER.x+PLAYER.w/2, PLAYER.y-36,"#ffe066",120);
        ultMoves = { azul: false, vermelho: false, vazio: false, dominio: false };
      }

      // Input/Movimento
      if (!ultSkillState && !PLAYER.ultActive) {
        if (keys["arrowleft"]) {
          PLAYER.vx = -PLAYER.speed;
          PLAYER.dir = -1;
          if (PLAYER.grounded) PLAYER.state = "walkLeft";
        } else if (keys["arrowright"]) {
          PLAYER.vx = PLAYER.speed;
          PLAYER.dir = 1;
          if (PLAYER.grounded) PLAYER.state = "walkRight";
        } else {
          PLAYER.vx = 0;
          if (PLAYER.grounded) PLAYER.state = "idle";
        }
        if ((keys[" "] || keys["arrowup"]) && PLAYER.grounded) {
          PLAYER.vy = -PLAYER.jumpPower;
          PLAYER.grounded = false;
          PLAYER.state = "jump";
        }
      } else if (!ultSkillState && PLAYER.ultActive) {
        // Em ult mode, pode andar normalmente
        if (keys["arrowleft"]) {
          PLAYER.vx = -PLAYER.speed-0.4;
          PLAYER.dir = -1;
          if (PLAYER.grounded) PLAYER.state = "walkLeft";
        } else if (keys["arrowright"]) {
          PLAYER.vx = PLAYER.speed+0.4;
          PLAYER.dir = 1;
          if (PLAYER.grounded) PLAYER.state = "walkRight";
        } else {
          PLAYER.vx = 0;
          if (PLAYER.grounded) PLAYER.state = "idle";
        }
        if ((keys[" "] || keys["arrowup"]) && PLAYER.grounded) {
          PLAYER.vy = -PLAYER.jumpPower-2;
          PLAYER.grounded = false;
          PLAYER.state = "jump";
        }
      } else {
        PLAYER.vx = 0;
      }

      // Física Gojo
      PLAYER.x += PLAYER.vx;
      PLAYER.y += PLAYER.vy;
      if (!PLAYER.grounded) PLAYER.vy += GRAVITY;
      if (PLAYER.y >= GROUND_Y) {
        PLAYER.y = GROUND_Y;
        PLAYER.vy = 0;
        PLAYER.grounded = true;
        if (PLAYER.vx === 0) PLAYER.state = "idle";
        else PLAYER.state = PLAYER.dir === 1 ? "walkRight" : "walkLeft";
      }
      PLAYER.x = Math.max(0, Math.min(canvas.width-PLAYER.w, PLAYER.x));

      // Animação Gojo
      PLAYER.animTimer++;
      if (PLAYER.state === "idle") {
        if (PLAYER.animTimer % 20 === 0) PLAYER.animFrame = (PLAYER.animFrame+1)%loadedSprites.idle.length;
      } else if (PLAYER.state === "walkRight") {
        if (PLAYER.animTimer % 8 === 0) PLAYER.animFrame = (PLAYER.animFrame+1)%loadedSprites.walkRight.length;
      } else if (PLAYER.state === "walkLeft") {
        if (PLAYER.animTimer % 8 === 0) PLAYER.animFrame = (PLAYER.animFrame+1)%loadedSprites.walkLeft.length;
      } else if (PLAYER.state === "jump") {
        PLAYER.animFrame = 0;
      }

      // Enemies
      enemies.forEach(enemy => {
        if (!enemy.alive) return;
        // Paralisado?
        if (enemy.paralisado) {
          enemy.paralyzeTimer--;
          if (enemy.paralyzeTimer<=0) enemy.paralisado=false;
          return;
        }
        // Anda em direção ao Gojo
        let dx = PLAYER.x - enemy.x;
        let dist = Math.abs(dx);
        if (dist > 12) enemy.vx = Math.sign(dx) * 1.1;
        else enemy.vx = 0;
        enemy.x += enemy.vx;
        enemy.anim += 0.1 + Math.random()*0.02;
      });

      // Projéteis (base)
      for (let p of projectiles) {
        p.x += p.vx;
        p.y += p.vy;
        // colisão com inimigos
        for (let enemy of enemies) {
          if (!enemy.alive || enemy.paralisado) continue;
          if (p.x + p.r > enemy.x && p.x - p.r < enemy.x + enemy.w
              && p.y + p.r > enemy.y && p.y - p.r < enemy.y + enemy.h) {
            enemy.alive = false;
            if (p.type === "azul") balloon("Azul!", p.x, p.y-24,"#77ccff",54);
            if (p.type === "vermelho") balloon("Vermelho!", p.x, p.y-24,"#ff6666",54);
            if (p.type === "vazio") balloon("Vazio!", p.x, p.y-24,"#e0b6ff",54);
            p.hit = true;
          }
        }
      }
      projectiles = projectiles.filter(p => !p.hit && p.x>-48 && p.x<canvas.width+48 && p.y > -48 && p.y < canvas.height+48);

      // Ataques BASE
      if (!ultMode && !ultSkillState) {
        if (keys["j"]) { // Azul
          projectiles.push({x: PLAYER.x+PLAYER.w/2+PLAYER.dir*20, y: PLAYER.y+24, vx: 7*PLAYER.dir, vy:0, r:10, type:"azul"});
          balloon("Azul!", PLAYER.x+PLAYER.w/2, PLAYER.y-30,"#77ccff",54); keys["j"]=false;
          ultValue = Math.min(ultValue + 8, ULT_MAX);
        }
        if (keys["k"]) { // Vermelho
          projectiles.push({x: PLAYER.x+PLAYER.w/2+PLAYER.dir*24, y: PLAYER.y+22, vx: 12*PLAYER.dir, vy:0, r:7, type:"vermelho"});
          balloon("Vermelho!", PLAYER.x+PLAYER.w/2, PLAYER.y-30,"#ff6666",54); keys["k"]=false;
          ultValue = Math.min(ultValue + 10, ULT_MAX);
        }
        if (keys["l"]) { // Vazio
          projectiles.push({x: PLAYER.x+PLAYER.w/2+PLAYER.dir*17, y: PLAYER.y+26, vx: 9*PLAYER.dir, vy:0, r:14, type:"vazio"});
          balloon("Vazio!", PLAYER.x+PLAYER.w/2, PLAYER.y-35,"#e0b6ff",54); keys["l"]=false;
          ultValue = Math.min(ultValue + 12, ULT_MAX);
        }
        if (keys["u"]) { // Arremesso
          for (let enemy of enemies) {
            if (enemy.alive && Math.abs(enemy.x-PLAYER.x)<42 && Math.abs(enemy.y-PLAYER.y)<30) {
              enemy.vy = -9-Math.random()*4;
              enemy.vx = 2.3*PLAYER.dir;
              balloon("Arremesso!", enemy.x+16, enemy.y-32,"#f5e642",54); keys["u"]=false;
              ultValue = Math.min(ultValue + 6, ULT_MAX);
              break;
            }
          }
        }
        if (keys["i"]) { // Empurrão
          for (let enemy of enemies) {
            if (enemy.alive && Math.abs(enemy.x-PLAYER.x)<54 && Math.abs(enemy.y-PLAYER.y)<36) {
              enemy.vx = 7*PLAYER.dir;
              balloon("Empurrão!", enemy.x+16, enemy.y-32,"#45e2f5",54); keys["i"]=false;
              ultValue = Math.min(ultValue + 6, ULT_MAX);
            }
          }
        }
        if (keys["o"]) { // Campo de energia
          for (let enemy of enemies) {
            if (enemy.alive && Math.abs(enemy.x-PLAYER.x)<80 && Math.abs(enemy.y-PLAYER.y)<40) {
              enemy.vx = 6.2*(enemy.x>PLAYER.x?1:-1);
              balloon("Campo de Energia!", enemy.x+16, enemy.y-40,"#d4f542",54); keys["o"]=false;
              ultValue = Math.min(ultValue + 8, ULT_MAX);
            }
          }
        }
      }

      // Ultimate barra
      if (!ultMode && ultValue === ULT_MAX) {
        ultReady = true;
        document.getElementById('ultReadyMsg').style.display = "";
      } else {
        ultReady = false;
        document.getElementById('ultReadyMsg').style.display = "none";
      }

      // ULTIMATE MODE
      if (ultMode) {
        ultTimer += dt;
        if (!ultSkillState) {
          // Q: Azul Máximo
          if (keys["q"]) {
            ultSkillState = "azulmax";
            ultSkillTimer = 0; keys["q"]=false;
            azulNoCeu = false;
            azulObj = {
              x: PLAYER.x+PLAYER.w/2, y: PLAYER.y+24, r:18, state:0, t:0, pulling:[], goingUp:false
            };
            balloon("Azul Máximo!", azulObj.x, azulObj.y-60,"#42c9fa",94);
          }
          // W: Vermelho Máximo
          if (keys["w"]) {
            ultSkillState = "vermelhomax";
            ultSkillTimer = 0; keys["w"]=false;
            vermelhoObj = {
              x: PLAYER.x+PLAYER.w/2+PLAYER.dir*20, y: PLAYER.y+24, r:13, dir:PLAYER.dir, state:0, t:0
            };
            balloon("Vermelho Máximo!", vermelhoObj.x, vermelhoObj.y-42,"#ff5555",80);
          }
          // E: Vazio Roxo
          if (keys["e"]) {
            ultSkillState = "vazioroxo";
            ultSkillTimer = 0; keys["e"]=false;
            roxaoObj = {
              x: PLAYER.x+PLAYER.w/2+PLAYER.dir*26, y: PLAYER.y+28, r:21, dir:PLAYER.dir, t:0
            };
            balloon("Vazio Roxo!", roxaoObj.x, roxaoObj.y-42,"#a684e7",80);
          }
          // R: Expansão de Domínio
          if (keys["r"]) {
            ultSkillState = "dominio";
            ultSkillTimer = 0; keys["r"]=false;
            dominioObj = {
              x: PLAYER.x, y:PLAYER.y, r:0, state:0, t:0
            };
            balloon("Expansão de Domínio: Vazio Ilimitado!", PLAYER.x+PLAYER.w/2, PLAYER.y-90,"#fff",120);
          }
        }
      }

      // Ultimate skills animação & efeitos
      if (ultSkillState) {
        ultSkillTimer++;
        // Azul Máximo
        if (ultSkillState==="azulmax" && azulObj) {
          azulObj.t++;
          if (azulObj.state===0) {
            // Gira ao redor e puxa inimigos
            azulObj.r = 34 + Math.sin(azulObj.t/10)*6;
            azulObj.x = PLAYER.x+PLAYER.w/2 + Math.cos(azulObj.t/13)*32*PLAYER.dir;
            azulObj.y = PLAYER.y+30 + Math.sin(azulObj.t/11)*14;
            if (azulObj.t>36) azulObj.state=1, azulObj.t=0;
            // Puxa inimigos próximos
            for (let enemy of enemies) {
              if (enemy.alive && !enemy.paralisado) {
                let dx = azulObj.x-enemy.x, dy = azulObj.y-enemy.y;
                let dist = Math.hypot(dx,dy);
                if (dist < 120) {
                  enemy.vx += dx/dist*0.59;
                  enemy.vy += dy/dist*0.23;
                  if (dist < azulObj.r+12) {
                    enemy.alive=false;
                    balloon("Sugado pelo Azul!", enemy.x+16, enemy.y-24,"#42c9fa",54);
                  }
                }
              }
            }
          } else if (azulObj.state===1) {
            // Vai ao céu
            azulObj.goingUp = true;
            azulObj.y -= 5.5;
            if (azulObj.y < 40) azulObj.state=2, azulNoCeu=true, azulObj.t=0;
          } else if (azulObj.state===2) {
            // Fica no céu por ~5s
            if (azulObj.t>300) { azulObj=null; azulNoCeu=false; ultSkillState=null;}
          }
        }
        // Vermelho Máximo
        else if (ultSkillState==="vermelhomax" && vermelhoObj) {
          vermelhoObj.t++;
          if (!azulNoCeu) {
            // Feixe
            let len = Math.min(230, vermelhoObj.t*5);
            ctx.save();
            ctx.globalAlpha = 0.16+0.24*Math.sin(vermelhoObj.t/3);
            ctx.fillStyle = "#ff4c4c";
            ctx.fillRect(vermelhoObj.x, vermelhoObj.y-7, len*vermelhoObj.dir,14);
            ctx.restore();
            // Dano: área em frente
            for (let enemy of enemies) {
              if (!enemy.alive||enemy.paralisado) continue;
              let hit = false;
              if (vermelhoObj.dir>0 && enemy.x>vermelhoObj.x && enemy.x<vermelhoObj.x+len && Math.abs(enemy.y-vermelhoObj.y)<25) hit = true;
              if (vermelhoObj.dir<0 && enemy.x<vermelhoObj.x && enemy.x>vermelhoObj.x-len && Math.abs(enemy.y-vermelhoObj.y)<25) hit = true;
              if (hit) {
                enemy.alive = false;
                balloon("Desintegrado pelo Vermelho!", enemy.x+16, enemy.y-24,"#ff5555",54);
              }
            }
            if (vermelhoObj.t>22) {vermelhoObj=null; ultSkillState=null;}
          } else {
            // Interação: Azul no céu -> esfera se forma e sobe
            vermelhoObj.y -= 2.5;
            if (vermelhoObj.t>12) {
              // Criar Bola Roxa Gigante
              roxaoObj = {
                x: azulObj.x, y: azulObj.y+10, r: 34, dir:PLAYER.dir, t:0, area:true
              };
              balloon("Combinação: Vazio Roxo Supremo!", roxaoObj.x, roxaoObj.y-42,"#ae7fff",110);
              azulObj=null; azulNoCeu=false; vermelhoObj=null; ultSkillState="roxao";
            }
          }
        }
        // Vazio Roxo
        else if (ultSkillState==="vazioroxo" && roxaoObj) {
          roxaoObj.t++;
          roxaoObj.x += 12*PLAYER.dir;
          // Dano em tudo no caminho
          for (let enemy of enemies) {
            if (!enemy.alive||enemy.paralisado) continue;
            if (roxaoObj.x + roxaoObj.r > enemy.x && roxaoObj.x - roxaoObj.r < enemy.x + enemy.w
              && roxaoObj.y + roxaoObj.r > enemy.y && roxaoObj.y - roxaoObj.r < enemy.y + enemy.h) {
                enemy.alive = false;
                balloon("Eliminado pelo Vazio Roxo!", enemy.x+16, enemy.y-24,"#a684e7",54);
            }
          }
          if (roxaoObj.x < -80 || roxaoObj.x > canvas.width+80) { roxaoObj=null; ultSkillState=null; }
        }
        // Roxao (combinação Azul+Vermelho)
        else if (ultSkillState==="roxao" && roxaoObj) {
          roxaoObj.t++;
          roxaoObj.y += 4.5;
          if (roxaoObj.t>16) {
            // Explosão em área
            for (let enemy of enemies) {
              if (!enemy.alive||enemy.paralisado) continue;
              let dx = roxaoObj.x - (enemy.x+enemy.w/2), dy = roxaoObj.y - (enemy.y+enemy.h/2);
              if (Math.hypot(dx,dy)<roxaoObj.r+60) {
                enemy.alive = false;
                balloon("Aniquilado pela Bola Roxa Suprema!", enemy.x+16, enemy.y-24,"#ae7fff",86);
              }
            }
            roxaoObj=null; ultSkillState=null;
          }
        }
        // Expansão de Domínio: Vazio Ilimitado
        else if (ultSkillState==="dominio" && dominioObj) {
          dominioObj.t++;
          if (dominioObj.state===0) {
            dominioObj.r += 15;
            if (dominioObj.r > 270) dominioObj.state=1;
            for (let enemy of enemies) {
              if (!enemy.alive) continue;
              let dx = (PLAYER.x+PLAYER.w/2) - (enemy.x+enemy.w/2);
              let dy = (PLAYER.y+PLAYER.h/2) - (enemy.y+enemy.h/2);
              if (Math.hypot(dx,dy)<dominioObj.r) {
                enemy.paralisado = true;
                enemy.paralyzeTimer = 300; // 5s
              }
            }
          }
          if (dominioObj.t>320) { dominioObj=null; ultSkillState=null;}
        }
      }

      // ULTIMATE: Duração ~15s
      if (ultMode) {
        if (!ultSkillState) ultTimer += dt;
        if (ultTimer > 15.5) {
          ultMode = false; ultValue = 0; PLAYER.ultActive=false;
        }
      }

      // Balões de fala
      updateBalloons();

      // Render
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Draw
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // Chão
      ctx.fillStyle = "#4db04d";
      ctx.fillRect(0, GROUND_Y+PLAYER.h-8, canvas.width, 40);

      // Sombra Gojo
      ctx.save();
      ctx.globalAlpha = 0.21;
      ctx.beginPath();
      ctx.ellipse(PLAYER.x+PLAYER.w/2, GROUND_Y+PLAYER.h-2, 18, 7, 0,0,Math.PI*2);
      ctx.fillStyle = "#000";
      ctx.fill();
      ctx.restore();

      // Sombra e desenho dos inimigos
      enemies.forEach(enemy => {
        if (!enemy.alive) return;
        ctx.save();
        ctx.globalAlpha = 0.17;
        ctx.beginPath();
        ctx.ellipse(enemy.x+enemy.w/2, GROUND_Y+enemy.h-3, 15, 6, 0,0,Math.PI*2);
        ctx.fillStyle = "#000";
        ctx.fill();
        ctx.restore();

        ctx.save();
        ctx.translate(enemy.x+enemy.w/2, enemy.y+enemy.h/2);
        ctx.scale(Math.sign(enemy.vx)||1,1);
        ctx.globalAlpha = enemy.paralisado ? 0.5 : 1;
        ctx.drawImage(loadedEnemySprite, -enemy.w/2, -enemy.h/2, enemy.w, enemy.h);
        ctx.restore();
      });

      // Projéteis base
      for (let p of projectiles) {
        if (p.type==="azul") {
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fillStyle = "#42c9fa";
          ctx.shadowColor = "#6cf";
          ctx.shadowBlur = 14;
          ctx.fill();
          ctx.shadowBlur = 0;
        }
        if (p.type==="vermelho") {
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fillStyle = "#f55";
          ctx.shadowColor = "#faa";
          ctx.shadowBlur = 14;
          ctx.fill();
          ctx.shadowBlur = 0;
        }
        if (p.type==="vazio") {
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fillStyle = "#a684e7";
          ctx.shadowColor = "#e0b6ff";
          ctx.shadowBlur = 18;
          ctx.fill();
          ctx.shadowBlur = 0;
        }
      }

      // ULTIMATE SKILLS (animações)
      // Azul Máximo
      if (azulObj) {
        ctx.save();
        let grad = ctx.createRadialGradient(azulObj.x, azulObj.y, 10, azulObj.x, azulObj.y, azulObj.r);
        grad.addColorStop(0,"#c5f6ff");
        grad.addColorStop(0.23,"#42c9fa");
        grad.addColorStop(1,"#1a3e7a");
        ctx.beginPath();
        ctx.arc(azulObj.x,azulObj.y,azulObj.r,0,Math.PI*2);
        ctx.fillStyle = grad;
        ctx.shadowColor = "#88e0ff";
        ctx.shadowBlur = 40;
        ctx.globalAlpha = 0.95;
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.globalAlpha = 1;
        ctx.restore();
      }
      // Vermelho Máximo
      if (vermelhoObj && !azulNoCeu) {
        ctx.save();
        ctx.globalAlpha = 0.5;
        ctx.fillStyle = "#ff4c4c";
        ctx.fillRect(vermelhoObj.x, vermelhoObj.y-7, 170*vermelhoObj.dir,14);
        ctx.globalAlpha = 1;
        ctx.beginPath();
        ctx.arc(vermelhoObj.x,vermelhoObj.y,vermelhoObj.r,0,Math.PI*2);
        ctx.fillStyle = "#f55";
        ctx.shadowColor = "#faa";
        ctx.shadowBlur = 14;
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.restore();
      }
      // Bola Roxa (combinação)
      if (roxaoObj) {
        ctx.save();
        let grad = ctx.createRadialGradient(roxaoObj.x, roxaoObj.y, 9, roxaoObj.x, roxaoObj.y, roxaoObj.r);
        grad.addColorStop(0, "#fff");
        grad.addColorStop(0.14, "#e0b6ff");
        grad.addColorStop(0.44, "#a684e7");
        grad.addColorStop(1, "#3d006b");
        ctx.beginPath();
        ctx.arc(roxaoObj.x,roxaoObj.y,roxaoObj.r,0,Math.PI*2);
        ctx.fillStyle = grad;
        ctx.shadowColor = "#fff";
        ctx.shadowBlur = 42;
        ctx.globalAlpha = 0.98;
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.shadowBlur = 0;
        ctx.restore();
      }
      // Expansão de Domínio
      if (dominioObj) {
        ctx.save();
        ctx.globalAlpha = 0.18 + Math.sin(dominioObj.r/40)*0.08;
        ctx.beginPath();
        ctx.arc(PLAYER.x+PLAYER.w/2,PLAYER.y+PLAYER.h/2,dominioObj.r,0,Math.PI*2);
        ctx.fillStyle = "#b8a8ff";
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.restore();
      }

      // Gojo (sprites)
      let sprite;
      if (PLAYER.state === "idle") sprite = loadedSprites.idle[PLAYER.animFrame];
      else if (PLAYER.state === "walkRight") sprite = loadedSprites.walkRight[PLAYER.animFrame];
      else if (PLAYER.state === "walkLeft") sprite = loadedSprites.walkLeft[PLAYER.animFrame];
      else if (PLAYER.state === "jump") sprite = loadedSprites.jump[0];
      else sprite = loadedSprites.idle[0];
      ctx.drawImage(sprite, PLAYER.x, PLAYER.y, PLAYER.w, PLAYER.h);

      // Nome
      ctx.font = "bold 19px Arial";
      ctx.fillStyle = "#fff";
      ctx.strokeStyle = "#222";
      ctx.lineWidth = 3;
      ctx.strokeText("Gojo", PLAYER.x+2, PLAYER.y-6);
      ctx.fillText("Gojo", PLAYER.x+2, PLAYER.y-6);

      // Balões de fala
      for (let b of balloons) {
        let alpha = b.t/b.max;
        ctx.save();
        ctx.globalAlpha = Math.min(1,alpha+0.17);
        ctx.font = "bold 16px Arial";
        ctx.fillStyle = b.color;
        ctx.strokeStyle = "#222";
        ctx.lineWidth = 3;
        ctx.textAlign = "center";
        ctx.strokeText(b.text, b.x, b.y);
        ctx.fillText(b.text, b.x, b.y);
        ctx.restore();
      }

      // HUD: Ultimate barra
      const bar = document.getElementById('ultBar');
      const txt = document.getElementById('ultText');
      let ratio = ultValue/ULT_MAX;
      if (ultMode) ratio = 1;
      bar.style.width = (ratio*100).toFixed(1) + "%";
      txt.textContent = ultMode
        ? "Modo Ilimitado Ativo!"
        : (ultValue===ULT_MAX ? "ULT pronta!" : "Ultimate: "+ultValue.toFixed(0)+"%");
      bar.style.background = ultMode
        ? "linear-gradient(90deg,#e3f2fd 30%,#ce93d8 100%)"
        : "linear-gradient(90deg,#b0bec5 0%,#9575cd 100%)";
    }

    // Iniciar depois de sprites carregados
    preloadSprites(() => {
      requestAnimationFrame(gameLoop);
    });

    // Spawna um inimigo automaticamente no início
    setTimeout(spawnEnemy, 850);

  </script>
</body>
</html>
